>[!obj] Obiettivo
>Descrivere il comportamento asintotico delle **medie empiriche** di una successione $(X_{n})_{n\in\mathbb{N}}$ di v.a. quindi il comportamento di
>$$\overline{S_{n}}:= \frac{1}{n} \sum_{i = 1}^n X_{i}$$ per $n \to \infty$
>> Se $E[X_{1}] = E[X_{2}] \dots$ allora
>> $$E[\overline{S_{n}}] = \frac{1}{n}\sum_{i = 1}^n E[X_{i}] = E[X_{1}]$$

>[!important]  Caso Particolarmente Importante
>v.a. **iid** cioè v.a. $X_{1}, X_{2}, \dots$ indipendenti e identicamente distribuite
>In questo caso ci aspettiamo che $\overline{S_{n}} \to^{n\to \infty} E[X_{1}]$ in qualche senso
>>[!example] Lancio ripetuto di una moneta non necessariamente equilibrata
>>$$
>>X_{i} := \begin{cases}
> > 1 & \text{se all'i-esimo lancio esce testa} \\
> > 0 & \text{altrimenti}
> >\end{cases}
>>$$
>>$X_{1}, X_{2}, \dots$ sono v.a. i.i.d con comune distribuzione di Bernoulli di parametro $q \in [0,1]$, dove $q$ è la probabilità che esca testa in un singolo lancio
>>> $E[X_{i}] = q$ --> $\overline{S_{n}}$ è uno **stimatore non distorto** del parametro ignoto $q$

>[!teo] Legge Debole Dei Grandi Numeri
>Siano $X_{1}, X_{2}, \dots$ v.a. i.i.d con varianza finita, allora
>$$
>\overline{S_{n}} := \frac{1}{n} \sum_{i = 1}^n X_{i} \to^{n \to \infty} E[X_{1}] \text{ in } L^2
>$$
>Nel senso che
>$$
>E[|\overline{S_{n}}-E[X_{1}]|^2] = var(\overline{S_{n}}) = var\left( \frac{1}{n} \cdot S_{n} \right) = \frac{1}{n^2} \cdot var(S_{n}) = \frac{1}{n^2} \cdot \sum_{i = 1}^n var(X_{i}) =\frac{1}{n^2} \cdot n \cdot var(X_{1}) = \frac{var(X_{1})}{n}  \to^{n \to \infty} 0
>$$
>Qui
>$$
>L^2(\Omega, F, P) := \{ X \text{ v.a su } (\Omega, F, P) : E[|X|^2] < \infty \}
>$$
>ovvero $L^2$ spazio delle v.a. con momento secondo finito (equivalentemente: varianza finita)

## Integrazione Monte Carlo
Sia $g:[a,b] \to \mathbb{R}$ una funzione "misurabile" e limitata, cioè $||g||_{\infty} := sup_{x \in [a,b]} |g(x)| < \infty$.
>[!obj] Obiettivo
>Calcolare numericamente l'integrale
>$$\int_{a}^b g(x)dx$$


Procedura deterministica se $g$ è continua: somme di Riemann per approssimare l'integrale
$$
\sum_{i = 1}^N g(x_{i}^N)\cdot \frac{b - a}{n}
$$
dove
$$
x_{i}^N \in \left[ a + \frac{b-a}{N} \cdot (i - 1), a + \frac{b-a}{N} \cdot i \right)
$$
funziona bene per funzioni continue di una variabile

## Integrazione Monte Carlo (metodo stocastico)
Sia $\xi \sim Unif(a,b)$. Allora
$$
\begin{align}
E[g(\xi)] &=^{\text{formula di trasformazione}} \int_{\mathbb{R}} g(x) \cdot f_{\xi}(x)dx \\
E[g(\xi)] &= \frac{1}{b-a} \cdot \int_{a}^bg(x)dx
\end{align}
$$
Siano $\xi_{1}, \xi_{2}, \dots$ v.a. i.i.d. con comune distribuzione $Unif(a,b)$.
Poniamo
$$
X_{n} := g(\xi_{n}) \quad n \in \mathbb{N}
$$
--> $X_{1}, X_{2}, \dots$ sono v.a. i.i.d. con varianza finita, poiché $g$ limitata. Infatti
$$
\begin{align}
var(X_{1}) &= E[X_{1}^2] - E[X]^2 \\
& \leq E[X_{1}^2] = E[g(\xi_{1})^2] \\
& \leq ||g||_{\infty}^2 < \infty
\end{align}
$$
Ora, grazie alla legge debole dei grandi numeri:
$$
\overline{S_{n}} := \frac{1}{n} \cdot \sum_{i = 1}^n X_{i} \to^{n \to \infty} E[X_{1}] \quad \text{in }L^2
$$
Ma qui:
$$
\overline{S_{n}} = \frac{1}{n} \cdot \sum_{i = 1}^N g(\xi_{i}) \quad \text{implementabile!!!}
$$
mentre
$$
E[X_{1}] = E[g(\xi_{1})] = \frac{1}{b-a} \cdot \int_{a}^b g(x)dx := \mu
$$
stima dell'errore: $\forall \epsilon > 0$
$$
P(|\overline{S_{n}} - \mu| \geq \epsilon) \leq \frac{var(X_{1})}{n \cdot \epsilon^2} \leq \frac{||g||_{\infty}^2}{n \cdot \epsilon^2}
$$

## Fluttuazioni Delle Medie Empiriche
Sia $(X_{n})_{n \in \mathbb{N}}$ una successione di v.a. i.i.d. con varianza finita.
Dalla legge dei grandi numeri:
$$
\overline{S_{n}} := \frac{1}{n} \cdot \sum_{i = 1}^n X_{i} \to^{n\to \infty } E[X_{i}] \quad \text{in } L^2
$$
In più:
$$
E[|\overline{S_{n}}-E[X_{1}]^2|] =^{\text{v.a. i.i.d}} var(\overline{S_{n}}) = \frac{var(X_{1})}{n} \to \sqrt{ var(\overline{S_{n}}) } = \frac{\sqrt{ var(X_{1}) }}{\sqrt{ n }}
$$
--> fluttuazioni della media empirica $\overline{S_{n}}$ intorno al suo valor medio (ricorda $E[\overline{S_{n}}] = E[X_{1}]$) sono della grandezza $\frac{1}{\sqrt{ n }}$
>[!obj] Obiettivo
>Caratterizzare la distribuzione delle fluttuazioni per $n\to \infty$ ovvero risultato asintotico

Per ottenere un limite finito non-zero bisogna "normalizzare" le fluttuazioni $\overline{S_{n}} - E[X_{1}]$, cioè moltiplicare $\overline{S_{n}} - E[X_{1}]$ con un fattore proporzionale a $\sqrt{ n }$

> Con $\mu=E[X_{1}]=E[\overline{S_{n}}]$ abbiamo 
> $$
> \begin{align}
> \sqrt{ n }(\overline{S_{n}} - \mu) &= \sqrt{ n } \cdot \left( \frac{1}{n} \cdot \sum_{i=1}^n (X_{i}-\mu) \right) \\
> &= \frac{1}{\sqrt{ n }} \cdot \left( \sum_{i = 1}^n (X_{i} - \mu) \right)
\end{align}
> $$

Ora poniamo
$$
\tilde{Z_{n}} := \frac{1}{\sqrt{ n }} \cdot\left( \sum_{i = 1}^n (X_{i} - \mu) \right)
$$
Allora 
$$
E[\tilde{Z_{n}}] = \frac{1}{\sqrt{ n }} \cdot\left( \sum_{i = 1}^n E[X_{i} - \mu] \right) = 0
$$
> ==$E[X_{i} - \mu] = 0$==

mentre
$$
\begin{align}
var(\tilde{Z_{n}}) &= \frac{1}{n} \cdot var\left( \sum_{i = 1}^n X_i - \mu \right) \\
&= \frac{1}{n} \sum_{i = 1}^n var(X_{i}) = var(X_{1}) \\
 var(\tilde{Z_{n}}) &= var(X_{1})
\end{align}
$$
Si evince quindi che $E[\tilde{Z_{n}}] = 0$ mentre $var(\tilde{Z_{n}}) = var(X_{1})$
Sia $\sigma := \sqrt{ var(X_{1}) }$ la comune deviazione standard, allora $E[\tilde{Z_{n}}] = 0$, $var(\tilde{Z_{n}}) = \sigma^2$ --> $var\left( \frac{1}{\sigma} \cdot  \tilde{Z_{n}} \right) = \frac{1}{\sigma^2} \cdot var(\tilde{Z_{n}}) = 1$
>[!teo] Teorema Del Limite Centrale
>Sia $(X_{n})_{n \in \mathbb{N}}$ una successione di v.a. i.i.d. con varianza finita non-zero.
>Poniamo 
>$$
>\begin{align}
> \mu := E[X_{1}], & \quad \sigma^2 := var(X_{1}) \\
 \quad Z_{n} := \frac{1}{\sigma \sqrt{ n }} \cdot \left( \sum_{i = 1}^n (X_{i} - \mu) \right) &= \frac{S_{n}- n \mu }{\sigma \sqrt{ n }} =^{\text{oppure}} \frac{\sqrt{ n }}{\sigma} \cdot (\overline{S_{n}}-\mu) \\
> \frac{S_{n}- n \mu }{\sigma \sqrt{ n }} &= \frac{S_{n}- n \mu }{\sqrt{ \sigma^2 n }} = \frac{S_{n}- n \mu }{\sqrt{ var(S_{n})}}
>
\end{align}
>$$
> Allora $Z_{n}$ **converge in distribuzione**, per $n\to \infty$, a una **normale standard** nel senso che
> $$
> P(Z_{n} \leq x) = F_{Z_{n}}(x) \to^{n\to \infty} I(x) \quad \forall x \in \mathbb{R}
> $$
> dove $I$ è la funzione di ripartizione della normale standard
> > $E[Z_{n}] = 0, var(Z_{n}) = 1$ $\forall n \in \mathbb{N}$

>[!example] Controllo qualità
>Azienda che produce viti di un certo tipo. Effettua un controllo di qualità testando $n$ viti scelte a caso per determinare la proporzione di viti difettose
>> Modello:
>> $X_{1}, \dots,X_{n}$ v.a. a valori in $\{ 0, 1 \}$ con $X_{i} = 1$ se l'i-esima vite testata è difettosa, $X_{i} = 0$ altrimenti
>> Possiamo supporre: $X_{1} \dots X_{n}$ i.i.d.
>> --> $X_{1} \dots X_{n}$ i.i.d. con comune distribuzione di Bernoulli di parametro $q \in [0,1]$ dove $q$ è la probabilità che una vite scelta a caso sia difettosa
>
>Parametro $q$ è incognito.
>Possiamo usare la media empirica $\overline{S_{n}} = \frac{1}{n} \sum_{i = 1}^n X_{i}$ come **stimatore non distorto** di $q$. Infatti
>$$
>E[\overline{S_{n}}] = E[X_{1}] = q
>$$
>Dalla legge dei grandi numeri: $\overline{S_{n}}\to q$ in $L^2$.
>>[!obj] Obiettivo
>> Scegliere $n \in \mathbb{N}, \delta_{n} > 0$ tali che
>> $$
>> P(q \in (\overline{S_{n}}-\delta_{n}, \overline{S_{n}} + \delta_{n})) \geq 95\%
>> $$
>> Il 95% è un esempio, se vogliamo possiamo aumentare o abbassare la possibilità
>
>Siano $n \in \mathbb{N}, \delta_{n} > 0$ allora
>$$
>\begin{align}
>P(q \in (\overline{S_{n}}-\delta_{n}, \overline{S_{n}} + \delta_{n})) &= P(\overline{S_{n}} - \delta_{n} < q < \overline{S_{n}} + \delta_{n}) \\
> &= P(-\delta_{n} < q - \overline{S_{n}}< \delta_{n}) \\
> &= P(-\delta_{n} < \overline{S_{n}} - q < \delta_{n}) \\
> P(q \in (\overline{S_{n}}-\delta_{n}, \overline{S_{n}} + \delta_{n})) &= P(|\overline{S_{n}} - q| < \delta_{n})
>\end{align}
>$$
>Dato che vogliamo avere $P(|\overline{S_{n}} - q| < \delta_{n}) \geq 95\%$
>###### 1. Metodo: Disuguaglianza di Chebyshev
>$$
>P(|\overline{S_{n}} - q| < \delta_{n}) = 1 - P(|\overline{S_{n}} - q| \geq \delta_{n})
>$$
>Poiché $q = E[\overline{S_{n}}]$
>$$
>\begin{align}
>P(|\overline{S_{n}} - q| \geq \delta_{n}) &\leq \frac{var(\overline{S_{n}})}{\delta_{n}^2} & var(\overline{S_{n}}) = \frac{var(X_{1})}{n} \\
> & \leq \frac{q \cdot (1 - q)}{n \cdot \delta_{n}^2} & \stackrel{X_{1} \sim Ber(q)}{=} \frac{q \cdot (1 - q)}{n \cdot \delta_{n}^2}
\end{align}
>$$
>--> $P(q \in (\overline{S_{n}}-\delta_{n},\overline{S_{n}}+\delta_{n}))\geq 1 - \frac{q \cdot (1 - q)}{n \cdot \delta_{n}^2}$
>Vogliamo quindi che $\frac{q \cdot (1 - q)}{n \cdot \delta_{n}^2} \geq 0.95$
>$$
>\begin{align}
>n \cdot \delta_{n}^2 \geq \frac{1}{005} \cdot q \cdot (1 - q) \quad \text{dove } q \cdot(1 - q) \leq \frac{1}{4} \\
>n \cdot \delta_{n}^2 \geq \frac{20}{4} = 5
\end{align}
>$$
>Ad esempio possiamo prendere:
>- $n = 45$ --> $\delta_{n}^2 \geq \frac{1}{9}$ --> $\delta_{n} \geq \frac{1}{3}$
>- $\delta_{n} = \frac{1}{10}$ --> $n \geq 500$
>
>---
>###### 2. Metodo: Approssimazione Normale
>Dal Teorema del limite centrale abbiamo che $\frac{\sqrt{ n }}{\sqrt{ var(X_{1}) }} \cdot (\overline{S_{n}} - q)$ è **vicina in distribuzione** a una normale standard se $n$ è abbastanza grande.
>$$
>\begin{align}
>P(|\overline{S_{n}} - q| < \delta_{n}) &= P\left(\left|\frac{\sqrt{ n }}{\sqrt{ q \cdot (1 - q) }} \cdot (\overline{S_{n}} - q)\right| < \frac{\sqrt{ n }}{\sqrt{ q \cdot (1 - q) }}\cdot \delta_{n}\right) \\
>&\approx P(|Z| < \frac{\sqrt{ n }}{\sqrt{ q \cdot (1 - q) }} \cdot \delta_{n} ) & \text{Sia } Z \sim N(0,1)
\end{align}
>$$
>Ora le $Z \sim N(0,1)$
>$$
>\begin{align}
>P\left(|Z| < \frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q \cdot (1 - q) }}\right) &= P\left( Z \leq \frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1 - q) }} \right) - P\left( Z \leq - \frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1-q) }} \right) \\
> &= I\left(\frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1-q) }}\right) - I\left(-\frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1-q) }} \right) \\
> \text{per simmetria: } I(-x) &= 1-I(x) \\
>P\left(|Z| < \frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1-q) }}\right) &= 2I\left(\frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1-q) }} \right) - 1
>\end{align}
>$$
>Cerchiamo $y \in \mathbb{R}$ minimo tale che $2I(y) - 1 \geq 0.95$ <==> $I(y) \geq 0.975$ --> dalle tavole della normale $y \geq 1.96$
>-->
>$$
>\begin{align}
>\frac{\delta_{n} \cdot \sqrt{ n }}{\sqrt{ q (1 - q) }} &\geq 1.96 \\
>\delta_{n} \cdot \sqrt{ n } &\geq \frac{1.96}{2}
\end{align}
>$$
>Nell'esempio:
>- $n = 45$ --> $\delta_{n}\geq 0.98 \cdot \frac{1}{\sqrt{ 45 }}$ --> $\delta_{n} \gtrsim \frac{1}{7}$
>- $\delta_{n} = \frac{1}{10}$ --> $\sqrt{ n } \geq 10 \cdot \frac{1.96}{2} = 9.8$ --> $n \gtrsim 100$






